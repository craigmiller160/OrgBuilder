<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OrgBuilder - Manage Orgs</title>
    <link rel="stylesheet" type="text/css" href="../css/org-styles.css" />
</head>
<body>
    <h1>Manage Orgs</h1>
    <p>
        <a id="logoutButton" href="../index.html">Logout</a>
    </p>
    <p>
        <a id="mainMenuButton" href="../main.html">Main Menu</a>
    </p>

    <h3>Orgs</h3>

    <table id="orgsTable" border="1">
        <thead>
            <tr>
                <th>Org Name</th>
                <th>Created Date</th>
                <th>Options</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

<script src="../jquery-3.1.1.js"></script>
<script src="../js/org-props.js"></script>
<script src="../js/orgbuilder.js"></script>
<script>
    $(document).ready(function(){
        if(orgbuilder.jwt.getToken() === null){
            console.log("No access token");
            window.location = "access-denied.html";
        }

        $("#logoutButton").click(orgbuilder.jwt.clearToken);

        var tableBody = $("#orgsTable tbody");

        //TODO need to add pagination
        orgbuilder.api.call("orgs", orgbuilder.methods.get)
            .done(function(data,status,jqXHR){
                //TODO need to be able to test that the data has the right contents
                $.each(data.orgList, function(index, org){
                    var newRow = $("<tr index='" + index + "'></tr>");
                    newRow.append($("<td></td>").text(org.orgName));
                    newRow.append($("<td></td>").text(org.createdDate));

                    var options = $("<td></td>");
                    options.append($("<button type='button' title='Edit Org'></button>").text("E"));
                    options.append($("<button type='button' title='Delete Org'></button>").text("D"));


                    newRow.append(options);
                    tableBody.append(newRow);
                });
                //TODO also add the ability to open the users page for the org
            });
    });
</script>
</body>

</html>