<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OrgBuilder</title>
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/org-styles.css" />
    <script>
        //IMPORTANT: This JavaScript doesn't use any of the application API so that it can be super-lightweight and run before page load. This means changes to the client API will not affect this
        //Send the user to the main.html page if the access token already exists.
        //        if(localStorage.getItem("orgapiToken") !== undefined && localStorage.getItem("orgapiToken") !== null){
        //            window.location = "main.html";
        //        }
    </script>
</head>
<body>
<div id="navbar-container">
    <!-- Placeholder container for the navbar from the template -->
</div>
<div class="container">
    <div id="login-box">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-sm-offset-3">
                <div id="actionAlert" class="alert fade">
                    <a href="#" class="close" data-hide="alert" aria-label="close">&times;</a>
                    <p></p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-sm-offset-3">
                <div class="well well-lg">
                    <form class="form-login">
                        <h2 class="heading">Log In</h2>
                        <div class="form-group">
                            <label for="emailField" class="sr-only">Email address</label>
                            <input type="email" id="emailField" class="form-control" title="User email address" placeholder="Email address" required autofocus />
                            <label for="passwordField" class="sr-only">Password</label>
                            <input type="password" id="passwordField" class="form-control" title="User password" placeholder="Password" required />
                        </div>
                        <button id="loginBtn" class="btn btn-lg btn-default btn-block" type="submit">Log In</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="jquery-3.1.1.js"></script>
<script src="URI.js"></script>
<script src="bootstrap/js/bootstrap.js"></script>
<script src="js/org-props.js"></script>
<script src="js/orgbuilder.js"></script>
<script>
    $(document).ready(function () {

        /*************************
         * 1) Top Scope Variables
         *************************/

        /*******************************
         * 2) Access to Page Validation
         *******************************/

        /****************
         * 3) UI Actions
         ****************/

        $(".form-login").submit(login);

        /***********************************
         * 4) Core Business Logic Functions
         ***********************************/

        function login(event){
            if(event !== null){
                event.preventDefault();
            }

            var email = $("#emailField").val();
            var password = $("#passwordField").val();
            var jsonMsg = {
                "userEmail": email,
                "password": password
            };

            orgbuilder.api.send("auth", orgbuilder.methods.post, jsonMsg)
                .done(function(){
                    console.log("Login Success");
                    window.location = "index.html";
                })
                .fail(function(jqXHR){
                    console.log("Login failed: " + jqXHR.status + " " + jqXHR.statusText);
                    $("#errorAlert").removeClass("invisible");
                    $("#errorMsg").text("Invalid email or password.");
                    $("#passwordField").val("");
                });
        }

        /***********************
         * 5) Utility Functions
         ***********************/

        /*************************
         * 6) Page Initialization
         *************************/

        orgbuilder.menus.loadLoginTemplate();

    });
</script>
</body>
</html>